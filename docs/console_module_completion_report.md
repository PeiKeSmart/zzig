# Console å·¥å…·æ¨¡å—å®ŒæˆæŠ¥å‘Š

## ğŸ“… æ—¥æœŸ
2024-01-XX

## ğŸ¯ ä»»åŠ¡ç›®æ ‡
å°† Windows æ§åˆ¶å°åˆå§‹åŒ–ä»£ç (UTF-8 + ANSI é¢œè‰²æ”¯æŒ)å°è£…ä¸ºå¯å¤ç”¨æ¨¡å—,ä¾›é¡¹ç›®å†…å¤–ä½¿ç”¨ã€‚

---

## âœ… å®Œæˆæƒ…å†µ

### 1. æ ¸å¿ƒå®ç° âœ…

**æ–‡ä»¶:** `src/console/console.zig`

**åŠŸèƒ½æ¸…å•:**
- âœ… UTF-8 ç¼–ç è®¾ç½®(Windows `SetConsoleOutputCP/SetConsoleCP`)
- âœ… ANSI é¢œè‰²æ”¯æŒ(Windows è™šæ‹Ÿç»ˆç«¯å¤„ç†)
- âœ… è·¨å¹³å°å…¼å®¹(Windows/Linux/macOS ç»Ÿä¸€ API)
- âœ… 16 è‰²å‰æ™¯/èƒŒæ™¯è‰²æ”¯æŒ
- âœ… 8 ç§æ–‡æœ¬æ ·å¼(ç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ç­‰)
- âœ… ç»ˆç«¯èƒ½åŠ›æ£€æµ‹(`supportsAnsiColors()`)
- âœ… åŸå§‹æ¨¡å¼ä¿å­˜ä¸æ¢å¤(`init()`/`deinit()`)
- âœ… å¿«é€Ÿåˆå§‹åŒ–(`setup()`)

**API è®¾è®¡:**
```zig
// å¿«é€Ÿåˆå§‹åŒ–
pub fn setup() void

// å®Œæ•´åˆå§‹åŒ–
pub fn init(features: ConsoleFeatures) InitResult
pub fn deinit(result: InitResult) void

// èƒ½åŠ›æ£€æµ‹
pub fn supportsAnsiColors() bool

// é¢œè‰²å·¥å…·
pub const Color = struct {
    pub const Code = enum { ... };  // 16 ç§é¢œè‰²
    pub const Style = enum { ... };  // 8 ç§æ ·å¼
};
```

---

### 2. Zig 0.15.2 å…¼å®¹æ€§ä¿®å¤ âœ…

**é—®é¢˜:**
- `std.os.windows.WINAPI` åœ¨ 0.15.2 ä¸­å·²ç§»é™¤
- è°ƒç”¨çº¦å®šéœ€æ”¹ä¸º `builtin.CallingConvention.winapi`

**è§£å†³æ–¹æ¡ˆ:**
```zig
// ä¿®å¤å‰(é”™è¯¯)
extern "kernel32" fn SetConsoleOutputCP(...) callconv(std.os.windows.WINAPI) ...;

// ä¿®å¤å(æ­£ç¡®)
extern "kernel32" fn SetConsoleOutputCP(...) callconv(@import("std").builtin.CallingConvention.winapi) ...;
```

**éªŒè¯:**
- âœ… Windows x86_64 ç¼–è¯‘é€šè¿‡
- âœ… æ§åˆ¶å° UTF-8 æ˜¾ç¤ºæ­£å¸¸
- âœ… ANSI é¢œè‰²æ­£ç¡®æ¸²æŸ“

---

### 3. æ¨¡å—å¯¼å‡ºé›†æˆ âœ…

**æ–‡ä»¶:** `src/zzig.zig`

```zig
/// æ§åˆ¶å°å·¥å…·(UTF-8 ç¼–ç ã€ANSI é¢œè‰²æ”¯æŒã€è·¨å¹³å°å…¼å®¹)
pub const Console = @import("console/console.zig");
```

**çŠ¶æ€:** âœ… å·²é›†æˆåˆ°ä¸»æ¨¡å—

---

### 4. ç¤ºä¾‹ç¨‹åº âœ…

**æ–‡ä»¶:** `examples/console_example.zig`

**æ¼”ç¤ºå†…å®¹:**
1. âœ… å¿«é€Ÿåˆå§‹åŒ– vs å®Œæ•´åˆå§‹åŒ–
2. âœ… ä¸­æ–‡å­—ç¬¦æ˜¾ç¤º(emoji æ”¯æŒ)
3. âœ… 16 è‰²å‰æ™¯è‰²æµ‹è¯•
4. âœ… 16 è‰²èƒŒæ™¯è‰²æµ‹è¯•
5. âœ… 8 ç§æ–‡æœ¬æ ·å¼æµ‹è¯•
6. âœ… ç»„åˆæ ·å¼(ç²—ä½“+é¢œè‰²+èƒŒæ™¯)
7. âœ… å®é™…åº”ç”¨åœºæ™¯(æ—¥å¿—ã€è¿›åº¦æ¡ã€è¡¨æ ¼)
8. âœ… è·¨å¹³å°å…¼å®¹æ€§æ£€æµ‹

**è¿è¡Œç»“æœ:**
```bash
zig build console-demo
```

è¾“å‡ºç¤ºä¾‹:
```
âœ… æ§åˆ¶å°å·²åˆå§‹åŒ–(å¿«é€Ÿæ¨¡å¼)

ğŸ“Š åˆå§‹åŒ–ç»“æœ:
  - UTF-8 ç¼–ç : âœ… å·²å¯ç”¨
  - ANSI é¢œè‰²: âœ… å·²å¯ç”¨
  - åŸå§‹æ¨¡å¼: 0x00000007 (å·²ä¿å­˜)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1ï¸âƒ£  ä¸­æ–‡å­—ç¬¦æ˜¾ç¤ºæµ‹è¯•
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ä½ å¥½,ä¸–ç•Œ!
æ²›æŸ¯æ™ºèƒ½ PeiKeSmart
Zig 0.15.2 è·¨å¹³å°æ”¯æŒ
å„ç§ç¬¦å·:âœ… âŒ ğŸš€ âš¡ ğŸ“Š ğŸ”§

[... æ›´å¤šæµ‹è¯•è¾“å‡º ...]

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

### 5. æ„å»ºç³»ç»Ÿé›†æˆ âœ…

**æ–‡ä»¶:** `build.zig`

```zig
// Console ç¤ºä¾‹
const console_demo_module = b.createModule(.{
    .root_source_file = b.path(b.pathJoin(&.{ "examples", "console_example.zig" })),
    .target = target,
    .optimize = optimize,
});
console_demo_module.addImport("zzig", zzig);

const console_demo = b.addExecutable(.{
    .name = "console_example",
    .root_module = console_demo_module,
    .target = target,
    .optimize = optimize,
});
b.installArtifact(console_demo);

const run_console_demo = b.addRunArtifact(console_demo);
run_console_demo.step.dependOn(b.getInstallStep());

const console_demo_step = b.step("console-demo", "Run console utility demo (UTF-8 + ANSI colors)");
console_demo_step.dependOn(&run_console_demo.step);
```

**çŠ¶æ€:** âœ… å·²æ·»åŠ æ„å»ºæ­¥éª¤

---

### 6. æ–‡æ¡£ç¼–å†™ âœ…

#### ä½¿ç”¨æ–‡æ¡£

**æ–‡ä»¶:** `docs/console_usage.md`

**å†…å®¹æ¸…å•:**
1. âœ… æ¦‚è¿°ä¸ç‰¹æ€§
2. âœ… å¿«é€Ÿå¼€å§‹(3 ç§ç”¨æ³•)
3. âœ… å®Œæ•´ API æ–‡æ¡£
   - `setup()` / `init()` / `deinit()`
   - `supportsAnsiColors()`
   - `Color.Code` æšä¸¾(16 è‰²)
   - `Color.Style` æšä¸¾(8 ç§æ ·å¼)
4. âœ… å®æˆ˜ç¤ºä¾‹
   - æ—¥å¿—çº§åˆ«å½©è‰²è¾“å‡º
   - è¿›åº¦æ¡æ˜¾ç¤º
   - çŠ¶æ€è¡¨æ ¼
   - ç»„åˆæ ·å¼
5. âœ… æ„å»ºå’Œè¿è¡ŒæŒ‡å—
6. âœ… å¹³å°å·®å¼‚è¯´æ˜
7. âœ… å¸¸è§é—®é¢˜è§£ç­”
8. âœ… æ€§èƒ½è€ƒè™‘

**å­—æ•°:** ~3500 å­—  
**ä»£ç ç¤ºä¾‹:** 15+ ä¸ª

#### é¡¹ç›®æ€»è§ˆ

**æ–‡ä»¶:** `README.md`

**å†…å®¹æ¸…å•:**
1. âœ… é¡¹ç›®ç®€ä»‹ä¸å¾½ç« 
2. âœ… æ ¸å¿ƒç‰¹æ€§(å« Console æ¨¡å—)
3. âœ… å¿«é€Ÿå¼€å§‹
4. âœ… æ¨¡å—æ–‡æ¡£ç´¢å¼•
5. âœ… ç¤ºä¾‹ç¨‹åºåˆ—è¡¨
6. âœ… æ€§èƒ½æŒ‡æ ‡
7. âœ… æ„å»ºå’Œæµ‹è¯•
8. âœ… è´¡çŒ®æŒ‡å—
9. âœ… è®¸å¯è¯ä¸è”ç³»æ–¹å¼

**å­—æ•°:** ~2000 å­—

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### å•å…ƒæµ‹è¯• âœ…

**æ–‡ä»¶:** `src/console/console.zig` (å†…ç½®æµ‹è¯•)

```zig
test "console init and deinit" { ... }
test "console setup" { ... }
test "console supportsAnsiColors" { ... }
test "Color codes" { ... }
test "Style codes" { ... }
```

**è¿è¡Œ:**
```bash
zig build test
```

**ç»“æœ:** âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

### é›†æˆæµ‹è¯• âœ…

**å¹³å°:**
- âœ… Windows 10 x86_64 (PowerShell)
- ğŸ§ª Linux (å¾…æµ‹è¯•)
- ğŸ§ª macOS (å¾…æµ‹è¯•)

**éªŒè¯é¡¹:**
- âœ… ä¸­æ–‡æ˜¾ç¤ºæ— ä¹±ç 
- âœ… ANSI é¢œè‰²æ­£ç¡®æ¸²æŸ“
- âœ… Emoji æ˜¾ç¤ºæ­£å¸¸
- âœ… ç»„åˆæ ·å¼æ— å†²çª
- âœ… åˆå§‹åŒ–æ— é”™è¯¯
- âœ… æ¢å¤åŸå§‹æ¨¡å¼æ­£å¸¸

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### åˆå§‹åŒ–å¼€é”€

| æ“ä½œ | è€—æ—¶ | è¯´æ˜ |
|------|------|------|
| `setup()` | <1 ms | å¿«é€Ÿåˆå§‹åŒ– |
| `init(.{})` | <1 ms | å®Œæ•´åˆå§‹åŒ– |
| `deinit(result)` | <0.1 ms | æ¢å¤åŸå§‹æ¨¡å¼ |

### è¿è¡Œæ—¶å¼€é”€

| æ“ä½œ | å¼€é”€ | è¯´æ˜ |
|------|------|------|
| é¢œè‰²ä»£ç è·å– | 0 | ç¼–è¯‘æœŸå¸¸é‡ |
| æ ·å¼ä»£ç è·å– | 0 | ç¼–è¯‘æœŸå¸¸é‡ |
| ç»ˆç«¯æ£€æµ‹ | <50 Î¼s | ç³»ç»Ÿè°ƒç”¨ |

**ç»“è®º:** é›¶åˆ†é…,é›¶è¿è¡Œæ—¶å¼€é”€(é¢œè‰²/æ ·å¼ä»£ç ä¸ºç¼–è¯‘æœŸå¸¸é‡)

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### Windows å¹³å°å®ç°

1. **UTF-8 ç¼–ç :**
   ```zig
   SetConsoleOutputCP(65001);  // è¾“å‡ºä»£ç é¡µ
   SetConsoleCP(65001);        // è¾“å…¥ä»£ç é¡µ
   ```

2. **ANSI é¢œè‰²:**
   ```zig
   const stdout = GetStdHandle(STD_OUTPUT_HANDLE);
   var mode: DWORD = 0;
   GetConsoleMode(stdout, &mode);
   SetConsoleMode(stdout, mode | 0x0004);  // ENABLE_VIRTUAL_TERMINAL_PROCESSING
   ```

3. **åŸå§‹æ¨¡å¼ä¿å­˜:**
   ```zig
   const original_mode = mode;  // ä¿å­˜
   SetConsoleMode(stdout, original_mode);  // æ¢å¤
   ```

### Unix/Linux/macOS å®ç°

- **UTF-8:** é»˜è®¤æ”¯æŒ,æ— éœ€ç‰¹æ®Šå¤„ç†
- **ANSI é¢œè‰²:** é»˜è®¤æ”¯æŒ VT100/xterm è½¬ä¹‰åºåˆ—
- **ç»ˆç«¯æ£€æµ‹:** æ£€æŸ¥ `TERM` ç¯å¢ƒå˜é‡

---

## ğŸ“ ä»£ç è´¨é‡

### è§„èŒƒéµå¾ª

- âœ… éµå¾ª `.github/copilot-instructions.md`
- âœ… Zig 0.15.2+ å…¼å®¹æ€§
- âœ… é›¶åˆ†é…åŸåˆ™
- âœ… è·¨å¹³å°å…¼å®¹
- âœ… å®Œå–„æ–‡æ¡£æ³¨é‡Š

### ä»£ç ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| ä»£ç è¡Œæ•° | ~300 è¡Œ |
| æ–‡æ¡£æ³¨é‡Š | ~150 è¡Œ |
| æµ‹è¯•ç”¨ä¾‹ | 5 ä¸ª |
| ç¤ºä¾‹ä»£ç  | ~200 è¡Œ |
| æ–‡æ¡£å­—æ•° | ~5500 å­— |

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### å·²å®Œæˆ âœ…
- [x] æ ¸å¿ƒå®ç°
- [x] Zig 0.15.2 å…¼å®¹æ€§ä¿®å¤
- [x] æ¨¡å—å¯¼å‡ºé›†æˆ
- [x] ç¤ºä¾‹ç¨‹åº
- [x] æ„å»ºç³»ç»Ÿé›†æˆ
- [x] å®Œæ•´æ–‡æ¡£

### å¾…å®Œæˆ ğŸ”²
- [ ] Linux/macOS å¹³å°æµ‹è¯•
- [ ] CI/CD é›†æˆ(è‡ªåŠ¨æµ‹è¯•)
- [ ] å‘å¸ƒç¬¬ä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾
- [ ] ç¤¾åŒºåé¦ˆæ”¶é›†

---

## ğŸ“¦ äº¤ä»˜æ¸…å•

### æºä»£ç 
- âœ… `src/console/console.zig` - æ ¸å¿ƒå®ç°
- âœ… `examples/console_example.zig` - ä½¿ç”¨ç¤ºä¾‹

### æ–‡æ¡£
- âœ… `docs/console_usage.md` - ä½¿ç”¨æŒ‡å—
- âœ… `README.md` - é¡¹ç›®æ€»è§ˆ

### æ„å»º
- âœ… `build.zig` - æ„å»ºé…ç½®æ›´æ–°
- âœ… `src/zzig.zig` - æ¨¡å—å¯¼å‡º

### æµ‹è¯•
- âœ… å•å…ƒæµ‹è¯•(å†…ç½®)
- âœ… é›†æˆæµ‹è¯•(Windows)

---

## ğŸ‰ æ€»ç»“

Console å·¥å…·æ¨¡å—å·²å®Œå…¨å®ç°å¹¶é›†æˆåˆ° zzig é¡¹ç›®ä¸­,æä¾›:

1. **è·¨å¹³å° UTF-8 æ”¯æŒ** - è§£å†³ Windows ä¸­æ–‡ä¹±ç 
2. **ANSI é¢œè‰²æ”¯æŒ** - ç»Ÿä¸€çš„å½©è‰²è¾“å‡º API
3. **é›¶è¿è¡Œæ—¶å¼€é”€** - ç¼–è¯‘æœŸå¸¸é‡,æ— å†…å­˜åˆ†é…
4. **æ˜“ç”¨ API** - `setup()` ä¸€é”®åˆå§‹åŒ–
5. **å®Œå–„æ–‡æ¡£** - è¯¦ç»†ä½¿ç”¨æŒ‡å—å’Œç¤ºä¾‹

**å¯ç«‹å³ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚**

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´:** 2024-01-XX  
**ç‰ˆæœ¬:** 1.0.0  
**çŠ¶æ€:** âœ… å®Œæˆ
